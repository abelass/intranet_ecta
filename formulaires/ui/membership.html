
    <div id="membership" class="tab">
        <ul>

            <li>
                <label>Member number</label> #ENV{membernumber}
            </li>
            [(#SAISIE{input,ohim,
                    label=<:member:label_ohim:>})]                        
            <li>
                <label>Member type</label> 

                  
                
                <B_member_type>
                <select name="membertype" id="membertype">
                    <option value=''>Make a choice</option>
                   <BOUCLE_member_type(MEMBERS_TYPE){par num title}>
                    <option value='#ID_MEMBER_TYPE'[(#ID_MEMBER_TYPE|=={#ENV{membertype}}|oui) selected="selected"]>[(#TITLE|supprimer_numero)]</option>
                   </BOUCLE_member_type>
                </select>
                </B_member_type>
            </li>

            <li class="com">
                <label>Committee member</label>
                <fieldset>
                    
                    <ul>

                        [(#SAISIE{selection, incommitee,
            label=<:member:label_incommitee:>,
            datas=[(#ARRAY{'',Make a Choice,Yes,Yes,No,No,Com,Com})]})]
                        <li class="explication">
                            <small>Please specify a role and a year in the fields below. Once you have saved you will be able to add a new period by committee.</small>
                        </li>
                       <INCLURE{fond=formulaires/inc-commitees,env,ajax}/>
                    </ul>
                </fieldset>
            </li> 
            <B_ex_bodies>
            <li>
                <label>Executive Bodies</label>
                <select name="executivebodies" id="executivebodies">
                    <option value=''>Make a Choice</option>
               <BOUCLE_ex_bodies(EXECUTIVE_BODIES){par num title}>
                    <option value='#ID_ECTA_EXECUTIVE_BODY'[ (#ID_ECTA_EXECUTIVE_BODY|=={#ENV{executivebodies}}|oui)selected="selected"]> [(#TITLE|supprimer_numero)] </option>
                </BOUCLE_ex_bodies>
                 </select>
            </li>                  
            </B_ex_bodies>

            <li><label>Council Member</label>
                <div class="explication">
                    <small>Please specify a type and a year in the fields below. Once you have saved you will be able to add a new period.</small>
                </div>
            <?php
                $seq='#ENV{seq}';
                $start_date=0000;    
                $end_date=0000;  
                
               $champ0='<div><select class="statut" name="council_statut[new]">
                    <option value="">No</option>
                    <option value="Yes">Yes</option>
                    <option value="Com">Com</option>                                        
               </select>';  
               $champ1='<span> <b>From:</b> </span><input class="start_date" name="council_start_date[new]" type="text" value="'.$start_date.'"/>';
               $champ2='<span> <b>To:</b> </span><input class="start_date"  name="council_end_date[new]" type="text" value="'.$end_date.'"/></div>';
               $champs=$champ0.$champ1.$champ2;
                $sql=sql_select('*','spip_members_council','seq='.$seq,'','start_date DESC');
                
                if(sql_count( $sql)>0)$champs='';
                $count=0;
                                 
                while($councils=sql_fetch($sql)){
                    $start_date=0000;    
                    $end_date=''; 
                    $begin_tag='';
                    $end_tag='';
                    $limit=3;   
                    $count++;
 
                    if($councils['start_date']>0)$start_date=affdate($councils['start_date'],'Y');
                    if($councils['end_date']>0){
                        $end_date=affdate($councils['end_date'],'Y');
                        if($count==1){
                            if($councils['start_date']>0)$champs=$champ0.$champ1.$champ2;
                             $limit= 2;
                        }
                    }
                    if($count==$limit){
                        $begin_tag='<span class="switch">
                            <span class="open">+</span>
                            <span class="close">-</span>
                            </span><div class="cache">';
                        $end_tag='</div>';
                        }
                        
                        $champs.=recuperer_fond('formulaires/field_period_councils',
                            array(
                            'begin_tag'=>$begin_tag,
                            'end_tag'=>$end_tag, 
                            'id_membership_council'=>$councils['id_membership_council'], 
                            'statut'=>$councils['statut'],
                            'start_date'=>$start_date,
                            'end_date'=>$end_date,
                            'seq'=>$seq
                            ));       
                             
                           }
 $champs.=$end_tag;
                           echo "<div>$champs</div>";
                      

                
                ?>
            </li>
            [(#SAISIE{selection, memberofhonour,
                label=<:member:label_memberofhonour:>,
                datas=[(#ARRAY{'',Make a Choice,Yes,Yes,No,No})]})]
            [(#SAISIE{selection, pastpresident,
                label=<:member:label_pastpresident:>,
                datas=[(#ARRAY{'',Make a Choice,Yes,Yes,No,No})]})]                

            [(#SAISIE{input, sponsoredby1,
                label=<:member:label_sponsoredby1:>})]
            [(#SAISIE{input, sponsoredby2,
                label=<:member:label_sponsoredby2:>})]
            [(#SAISIE{input, datemembership,
                label=<:member:label_datemembership:>})]
            <li>
                <label>Other Association</label>
                <fieldset>
                    <ul>
                   <BOUCLE_ass(ASSOCIATIONS){par num title}>
                       <BOUCLE_ass_member(MEMBERS_ASSOCIATIONS){id_association}{id_member=#ENV{seq}}>
                        <li><label>[(#TITLE|supprimer_numero)]</label> <input name='associations[#ID_ASSOCIATION]' type='checkbox' value='#ID_ASSOCIATION' checked="checked"></li>
                       </BOUCLE_ass_member>
                    <li><label>[(#TITLE|supprimer_numero)]</label> <input name='associations[#ID_ASSOCIATION]' type='checkbox' value='#ID_ASSOCIATION'></li>
                    <//B_ass_member>                        
                   </BOUCLE_ass>
                    </ul>
                </fieldset>
            </li>
                [(#SAISIE{selection, pastcouncil,
                      label=<:member:label_pastcouncil:>,
                       datas=[(#ARRAY{'',Make a Choice,Yes,Yes,No,No})]})]
         </ul>
    
    </div><!-- membership -->
<script type="text/javascript">
    jQuery(document).ready(function(){
        $("a .ajax >.cache").unbind('click');
        $('.cache').hide('fast');
        $('.switch').click(function(){
            $(this).toggleClass('open').next().toggle('fast');       
            });
        });   
</script>
